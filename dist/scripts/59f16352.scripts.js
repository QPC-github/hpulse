(function(){"use strict";angular.module("jmxRtMonApp",["ngCookies","ngResource","ngSanitize"]).config(["$routeProvider",function(a){return a.when("/beans/:config",{templateUrl:"views/beans.html",controller:"BeansCtrl",tabname:"beans"}).when("/plots/:config",{templateUrl:"views/plots.html",controller:"PlotsCtrl",tabname:"plots"}).when("/",{templateUrl:"views/main.html",controller:"MainCtrl",tabname:"home"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$route",function(a,b){return a.$route=b}])}).call(this),function(){"use strict";angular.module("jmxRtMonApp").controller("MainCtrl",["$scope","$location","ConfigService","JmxRefresher",function(a,b,c,d){return a.$on("$routeChangeSuccess",function(){return d.disconnect()}),a.address="",a.goToAddress=function(){return c.set(c.URL_KEY,a.address),b.path("/beans/"+c.serialize())},a}])}.call(this),function(){"use strict";angular.module("jmxRtMonApp").controller("BeansCtrl",["$scope","JmxRefresher","ConfigService","$routeParams",function(a,b,c,d){var e,f;return a.beans=[],a.tree={},a.displayTree={expanded:!0,name:"Beans",children:[]},a.JmxRefresher=b,a.$on("$routeChangeSuccess",function(){return c.deserialize(d.config),b.disconnect(),b.fetch_data()}),a.$on("JmxRefresher.data_updated",function(){var c;return a.beans=_(b.beans).pluck("name"),_(a.beans).each(function(c){var d,e,f,g;return g=c.split(":"),f=g[0],e=g[1],a.tree[f]||(a.tree[f]={}),a.tree[f][e]||(a.tree[f][e]={}),d=_(b.beans).findWhere({name:c}),a.tree[f][e]=d}),c=e(a.tree,0),f(a.displayTree,{name:"Beans",children:c}),a.$apply()}),f=function(a,b){return a.name!==b.name&&raise("name mismatch"),a.value=b.value,_(b.children).each(function(b){var c;return c=_(a.children).findWhere({name:b.name}),c?f(c,b):a.children.push(b)})},e=function(a,b,c){var d,f,g,h;d=[],f=c,2===b&&a.name&&(f=a.name);for(g in a)h=a[g],h instanceof Object?d.push({name:g,children:e(h,b+1,""+f+"|"+g)}):d.push({name:g,value:h,path:""+f+"|"+g});return d}}])}.call(this),function(){"use strict";angular.module("jmxRtMonApp").controller("PlotsCtrl",["$scope","JmxRefresher","$routeParams","ConfigService","PlotStore",function(a,b,c,d,e){return a.plots=function(){return d.get(d.PLOTS_KEY)},a.JmxRefresher=b,a.$on("$routeChangeSuccess",function(){return d.deserialize(c.config),b.connect()}),a.$on("JmxRefresher.data_updated",function(a,b){var c;return c=d.get(d.PLOTS_KEY),_(c).each(function(a){var c,d,f,g,h,i;return i=a.split("|"),d=i[0],h=i[1],c=_(b).find(function(a){return a.name===d}),g=c[h],f={x:new Date,y:g},e.addDatapoint(a,f)})})}])}.call(this),function(){"use strict";angular.module("jmxRtMonApp").controller("NavCtrl",["$scope","$location","ConfigService",function(a,b,c){return a.goToUrl=function(a){return console.log("Go to",a),b.path("/"+a+"/"+c.serialize())}}])}.call(this),function(){"use strict";angular.module("jmxRtMonApp").factory("JmxRefresher",["$timeout","$rootScope","ConfigService",function(a,b,c){var d;return d={},d.error=void 0,d.connected=!1,d.url=function(){return c.get(c.URL_KEY)},d.beans=[],d.update_interval=function(){return c.get(c.REFRESH_PERIOD_KEY)},d.fetch_data=function(){return jQuery.getJSON(""+d.url()+"?callback=?",function(a){return a?(d.error=void 0,d.beans=a.beans,b.$broadcast("JmxRefresher.data_updated",a.beans)):void 0}).fail(function(){return console.log("ERROR"),d.error="Could not connect to '"+d.url()+"'. Make sure the location is reachable and returns a json document.",b.$apply()})},d.connect=function(){var b;return d.connected?void 0:(d.connected=!0,b=function(){return d.fetch_data(),a(function(){return d.connected?b():void 0},d.update_interval())},b())},d.disconnect=function(){return d.connected=!1},d}])}.call(this),function(){var a={}.hasOwnProperty;angular.module("jmxRtMonApp").factory("ConfigService",["$timeout","$rootScope",function(){var b;return b={},b.REFRESH_PERIOD_KEY="refresh",b.URL_KEY="url",b.PLOTS_KEY="plots",b.settings={refresh:200,url:"http://localhost:50070/jmx",plots:[]},b.set=function(a,c){return b.settings[a]=c},b.get=function(a){return b.settings[a]},b.serialize=function(){return encodeURIComponent(JSON.stringify(b.settings))},b.deserialize=function(c){var d,e,f,g;e=JSON.parse(decodeURIComponent(c)),g=[];for(d in e)a.call(e,d)&&(f=e[d],g.push(b.set(d,f)));return g},b}])}.call(this),function(){"use strict";angular.module("jmxRtMonApp").factory("PlotStore",["$timeout","$rootScope","ConfigService",function(){var a;return a={},a.plots={},a.addDatapoint=function(b,c){return a.plots[b]=c},a.getLatestDatapoint=function(b){var c;return c=a.plots[b],c?c:null},a}])}.call(this),function(){"use strict";angular.module("jmxRtMonApp").directive("plot",["PlotStore",function(a){return{restrict:"E",replace:!0,scope:{path:"="},template:'<div class="plot">\n	<h3>{{formattedPath()}}</h3>\n	<canvas width="800px" height="200px" class="plot_canvas"></canvas>\n</div>',link:function(b,c){var d,e,f;return d=c.find(".plot_canvas")[0],e=new SmoothieChart({maxValueScale:1.2,interpolation:"linear",minValue:0,millisPerPixel:100}),e.streamTo(d,300),f=new TimeSeries,b.PlotStore=a,b.$watch("PlotStore",function(){var c;return(c=a.getLatestDatapoint(b.path))?f.append(c.x.getTime(),c.y):void 0},!0),e.addTimeSeries(f,{strokeStyle:"rgb(0, 255, 0)",linewidth:3}),b.formattedPath=function(){var a;return b.path.match(/^Hadoop:service=/)?(a=b.path.replace("Hadoop:service=",""),a=a.replace(",name=","."),a=a.replace("|",".")):b.path}}}}])}.call(this),function(){angular.module("jmxRtMonApp").directive("tree",["$compile",function(a){return{restrict:"E",scope:{model:"="},template:'<span class="pointable">\n  <span ng-click="model.expanded = !model.expanded">\n    <span ng-show="model.children && !model.expanded"> <i class="fa fa-caret-right"></i> </span>\n    <span ng-show="model.children &&  model.expanded"> <i class="fa fa-caret-down"></i> </span>\n    <span ng-show="model.children">\n      {{model.name}}\n    </span>\n    <span ng-show="!model.children">\n      <prototype model="model"></prototype>\n    </span>\n  </span>\n  <div style="padding-left: 15px" ng-repeat="child in model.children" ng-show="model.expanded">\n    <tree model="child"></tree>\n  </div>\n</span>',compile:function(b){var c,d;return d=b.contents().remove(),c=void 0,function(b,e){return c||(c=a(d)),c(b,function(a){return e.append(a)})}}}}])}.call(this),function(){angular.module("jmxRtMonApp").directive("prototype",["$compile","ConfigService","PlotStore",function(a,b){return{restrict:"E",scope:{model:"="},template:"<span ng-class=\"{'label-primary': isSelected(), 'label-default': is_numeric, label: is_numeric}\" ng-click=\"toggle()\">\n  {{model.name}} = <code>{{model.value}}</code>\n</span>",link:function(a){return"number"==typeof a.model.value&&(a.is_numeric=!0),a.isSelected=function(){var c;return a.is_numeric?(c=b.get(b.PLOTS_KEY),_(c).contains(a.model.path)):void 0},a.toggle=function(){var c,d,e,f;return a.is_numeric?(f=b.get(b.PLOTS_KEY),e=a.model.path,_(f).contains(e)?(c=_(f).find(function(a){return a===e}),d=f.indexOf(c),d>-1?f.splice(d,1):void 0):f.push(e)):void 0}}}}])}.call(this);